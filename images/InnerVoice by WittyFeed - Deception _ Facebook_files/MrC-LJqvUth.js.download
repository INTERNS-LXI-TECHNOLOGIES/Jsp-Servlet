if (self.CavalryLogger) { CavalryLogger.start_js(["YPRWf"]); }

__d("MInitJewelCounts",["Stratcom"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=[],i=!1;function j(a){g.invoke("m:jewels:init-counts",null,a)}function a(a){j(a),i||h.push(a)}function b(){if(i)return;i=!0;var a=h.splice(0,h.length);a.forEach(function(a){j(a)})}e.exports={main:a,replayMissedEvents:b}}),null);
__d("MTabbable",["MAria","MJSEnvironment","MViewport","isNodeWithinRect"],(function(a,b,c,d,e,f,g,h,i,j){__p&&__p();function k(a,b){while(a&&a!==b){if(g.isHidden(a))return!0;a=a.parentNode}return!1}function l(a,b){if(a.offsetHeight===0||a.offsetWidth===0||window.getComputedStyle(a).visibility==="hidden"||parseInt(a.tabIndex,10)<0||k(a,b))return!1;if(a.tabIndex>=0)return!0;switch(a.tagName){case"A":return a.href&&a.rel!="ignore";case"INPUT":return a.type!="hidden"&&a.type!="file"&&!a.disabled;case"BUTTON":case"SELECT":case"TEXTAREA":return!a.disabled}return!1}function a(a){__p&&__p();if(!a.getBoundingClientRect)return;var b=h.IS_APPLE_WEBKIT_IOS&&parseFloat(h.OS_VERSION)>=8||h.BROWSER_NAME==="Safari"&&!h.IS_APPLE_WEBKIT_IOS;b=b?a.querySelectorAll("a, button, select, [tabindex]"):a.querySelectorAll("a, button, input, select, textarea, [tabindex]");var c=i.getBoundingRect();for(var d=0,e;e=b[d];d++)if(l(e,a)&&j(e,c)){e.focus();return}}f.focusTabbable=a}),null);
__d("Popover",["CSS","DOM","MAria","MViewport","Stratcom","Vector","$","eventsMixinDeprecated","nullthrows","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){__p&&__p();var q=40;function r(a){"use strict";__p&&__p();var b=a.flyout;b=typeof b==="string"?m(b):b;this.flyout=b;this.content=h.scry(this.flyout,"div","flyout-content")[0];this.options=a;this._onOrientationChange=this._reposition.bind(this);this.jewelRedirect=a.jewelRedirect;g.conditionClass(this.flyout,"popover_flyout",!0);b=a.button;b&&(b=typeof b==="string"?m(b):b,this.buttonClickListener=h.listen(b,"click",null,this._openHandler.bind(this)),b.setAttribute("role","button"),i.setupPopup(b,this.flyout),this.button=b);b=a.flyoutAnchor;b?this.flyoutAnchor=typeof b==="string"?m(b):b:this.flyoutAnchor=this.button;this.options.flyoutFromRoot&&(this.flyoutClickListener=h.listen(this.flyout,"click",null,this._openHandler.bind(this)));this.options.touchstart_callback&&(this.flyoutTouchStartListener=h.listen(this.flyout,"touchstart",null,this._touchStartHandler.bind(this)));this.options.touchmove_callback&&(this.flyoutTouchMoveListener=h.listen(this.flyout,"touchmove",null,this._touchMoveHandler.bind(this)));this.options.touchend_callback&&(this.flyoutTouchEndListener=h.listen(this.flyout,"touchend",null,this._touchEndHandler.bind(this)));r._instances[this.flyout.id]=this}r.prototype.isOpen=function(){"use strict";return!!this._isOpen};r.prototype.open=function(){"use strict";__p&&__p();if(this.isOpen())return;r._activePopover&&r._activePopover.close();r._activePopover=this;this._isOpen=!0;this.constraint=null;this.jewelRedirect||g.conditionClass(this.flyout,"popover_hidden",!1);this.options.flyoutFromRoot&&this._absolutePositionFlyout();this._position();this.options.heightConstraint||(g.conditionClass(o(document.body),"disableClicks",!0),this.globalListener=k.listenCapture("click",null,this._closeHandler.bind(this)));window.addEventListener("orientationchange",this._onOrientationChange,!1);i.showPopup(this.button,this.flyout);if(this.options.ensureVisible){var a=j.getScrollTop(),b=this._getElementPosition(this.flyout).y,c=b+this.flyout.offsetHeight;c=c-(a+j.getUseableHeight());if(c>0){c=Math.min(c,Math.max(b-a-q,0));j.scrollTo(0,a+c)}}this.invoke("open")};r.prototype.close=function(a){"use strict";__p&&__p();if(!this.isOpen())return;r._activePopover=null;this._isOpen=!1;g.conditionClass(this.flyout,"popover_hidden",!0);this.options.flyoutFromRoot&&this.flyoutParent&&(this.flyoutParent.appendChild(this.flyout),delete this.flyoutParent);p(function(){g.conditionClass(o(document.body),"disableClicks",!1)}.bind(this),400);this.globalListener&&this.globalListener.remove();window.removeEventListener("orientationchange",this._onOrientationChange,!1);this._releaseConstraint();i.hidePopup(this.button,this.flyout);a||this.invoke("close")};r.prototype.clear=function(){"use strict";this.globalListener&&this.globalListener.remove(),this.buttonClickListener&&this.buttonClickListener.remove(),this.flyoutClickListener&&this.flyoutClickListener.remove(),this.flyoutTouchStartListener&&this.flyoutTouchStartListener.remove(),this.flyoutTouchMoveListener&&this.flyoutTouchMoveListener.remove(),this.flyoutTouchEndListener&&this.flyoutTouchEndListener.remove(),delete r._instances[this.flyout.id]};r.prototype.refreshConstraints=function(){"use strict";if(!this._isOpen||this.jewelRedirect)return!1;var a=this.flyout;this._releaseConstraint();this.options.heightConstraint?(a.style.minHeight=j.getUseableHeight()+"px",this.constraint=j.addHeightConstraint(l.getDim(this.content).y+this._getElementPosition(a).y)):this.constraint=j.addMinHeightConstraint(l.getDim(a).y+this._getElementPosition(a).y+r._MARGIN)};r.prototype._getTouchPoint=function(event){"use strict";var a,b=event.getRawEvent();b instanceof TouchEvent&&(a=b.targetTouches[0]);b={x:a?a.screenX:0,y:a?a.screenY:0};return b};r.prototype._touchStartHandler=function(event){"use strict";var a=this.options.touchstart_callback;a&&a(this._getTouchPoint(event))};r.prototype._touchMoveHandler=function(event){"use strict";if(this.isOpen()){var a=this.options.touchmove_callback;a&&a(this._getTouchPoint(event))}};r.prototype._touchEndHandler=function(event){"use strict";var a=this.options.touchend_callback;a&&a(this._getTouchPoint(event))};r.prototype._openHandler=function(event){"use strict";__p&&__p();this.jewelRedirect||event.prevent();var a=this.isOpen();if(a&&!this.options.preventClose)this.close();else if(!a){a=h.scry(document,"input");for(var b=0;b<a.length;b++)a[b].blur();this.open()}};r.prototype._closeHandler=function(event){"use strict";event.getNode("popover")||this.close()};r.prototype._getElementPosition=function(a){"use strict";__p&&__p();a=a;var b=a.offsetLeft,c=a.offsetTop;a=a.offsetParent;while(a&&a!==document.documentElement){b+=a.offsetLeft;c+=a.offsetTop;var d=window.getComputedStyle(a);b+=parseInt(d.getPropertyValue("border-left-width").slice(0,-2),10);c+=parseInt(d.getPropertyValue("border-top-width").slice(0,-2),10);a=a.offsetParent}return new l(b,c)};r.prototype._absolutePositionFlyout=function(){"use strict";this.flyoutParent=this.flyout.parentNode;m("root").appendChild(this.flyout);var a=this._getElementPosition(this.flyout.parentNode),b=this._getElementPosition(this.flyoutAnchor),c=l.getDim(this.flyoutAnchor);b=b.y-a.y+c.y;this.flyout.style.position="absolute";this.flyout.style.top=b+"px"};r.prototype._position=function(){"use strict";var a=this.flyout;if(this.flyoutAnchor&&this.options.positionNub){var b=this._getElementPosition(this.flyoutAnchor),c=h.find(this.flyout,"*","nub"),d=l.getDim(c).x,e=l.getDim(this.flyoutAnchor).x;a=this._getElementPosition(a);new l(b.x-a.x+(e-d)/2,0).setPos(c)}this.refreshConstraints()};r.prototype._reposition=function(){"use strict";p(this._position.bind(this),0)};r.prototype._releaseConstraint=function(){"use strict";this.constraint&&(this.constraint.release(),this.constraint=null)};r.getInstance=function(a){"use strict";return r._instances[a]};r.clearAll=function(){"use strict";for(var a=0;a<r._instances.length;a++)r._instances[a].clear()};r._activePopover=null;r._MARGIN=40;r._instances={};n(r,["open","close"]);e.exports=r}),null);
__d("MJewel",["CSS","DOM","MHistory","MJSEnvironment","MLogState","MTabbable","MViewport","Popover","Stratcom","URI","$","eventsMixinDeprecated","intlNumUtils","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){__p&&__p();var u="/friends/center/requests/";function v(a,b){"use strict";this._sigil=a,this.options=b||{},this._jewelNode=q(v.JEWEL_NAV_NODE_ID),this._softState=b.softState||"jewel="+v.nextID++,this._duringInit=!1,this.jewelRedirect=b.jewelRedirect,this._createPopover(),o.listen("m:history:change",null,this._updateJewelsOnHistoryChange.bind(this))}v.prototype._updateJewelsOnHistoryChange=function(event){"use strict";var a=new p(event.getData().path);a=a.getPath();a=this.jewelRedirect&&this.isOpen()&&!event.getData().soft&&a===u;event.getData().soft===this._softState||a?this._popover&&this._popover.open():this._popover&&this._popover.close()};v.prototype.isInitialized=function(){"use strict";var a=this.options.contentsSigil||"contents";return!!h.scry(this._jewelNode,"*",a)[0]};v.prototype._getJewelElement=function(){"use strict";return h.find(this._jewelNode,"div",this._sigil)};v.prototype._getCountElement=function(){"use strict";return h.find(this._getJewelElement(),"span","count")};v.prototype._getContentsElement=function(){"use strict";var a=this.options.contentsSigil||"contents";return h.find(this._getJewelElement(),"*",a)};v.prototype._getFlyoutElement=function(){"use strict";return h.find(this._getJewelElement(),"*","flyout")};v.prototype.getCount=function(){"use strict";return this._count};v.prototype.setDuringInit=function(a){"use strict";this._duringInit=a};v.prototype._updateCountElement=function(){"use strict";var a=this._getJewelCount();h.setContent(this._getCountElement(),s.formatNumberWithThousandDelimiters(a||0));a=this._getJewelElement();var b=this._count>0;g.conditionClass(a,"noCount",!b);g.conditionClass(a,"hasCount",b)};v.prototype.setCount=function(a){"use strict";if(a<0)return;this._count=a;this._updateCountElement()};v.prototype.setHeaderText=function(a,b){"use strict";__p&&__p();if(!a||!b)return;var c=this._getFlyoutElement();if(!c)return;c=h.scry(c,"*",a)[0];if(!c)return;a=c.cloneNode(!0);a.innerText=b;h.replace(c,a)};v.prototype.handleViewedContent=function(){"use strict";this.getCount()>0&&this.isInitialized()?(this.setCount(0),this.invoke("cleared")):this.invoke("jewel_click")};v.prototype.setMenuContent=function(a){"use strict";h.setContent(this._getFlyoutElement(),a),this.isOpen()&&this.handleViewedContent()};v.prototype.prependMenuContent=function(a){"use strict";h.prependContent(this._getContentsElement(),a)};v.prototype.removeMenuContent=function(a){"use strict";a=document.getElementById(a);a&&h.remove(a)};v.prototype.updateMenuColor=function(a,b,c){"use strict";c?t(this._updateMenuColor.bind(this,a,b),v.MARK_READ_DELAY):this._updateMenuColor(a,b)};v.prototype._updateMenuColor=function(a,b){"use strict";a=document.getElementById(a);a&&(g.conditionClass(a,v.M_AREA_LIGHTBLUE,!b),g.conditionClass(a,v.M_AREA_WHITE,b))};v.prototype._createPopover=function(){"use strict";var a=this._getJewelElement(),b=h.find(a,"div","flyout");this._popover=new n({button:h.find(a,"*","icon"),flyout:b,ensureVisible:!1,heightConstraint:!0,preventClose:!0,jewelRedirect:this.jewelRedirect});this._onOpenListener=this._popover.listen("open",this._onOpen.bind(this));this._onCloseListener=this._popover.listen("close",this._onClose.bind(this));this._popoverClickListener=h.listen(b,"click",null,this._onPopoverClick.bind(this));j.IS_ANDROID&&j.GET_OS_VERSION>=4&&(this._scrollAreaNode=h.scry(b,"div","scroll-area")[0])};v.prototype.clear=function(){"use strict";this._onOpenListener&&this._onOpenListener.remove(),this._onCloseListener&&this._onCloseListener.remove(),this._popoverClickListener&&this._popoverClickListener.remove(),this._popoverTouchStartListener&&this._popoverTouchStartListener.remove(),this._touchMoveListener&&this._touchMoveListener.remove(),this._touchStartListener&&this._touchStartListener.remove(),this._popover&&this._popover.clear()};v.prototype._onPopoverClick=function(event){"use strict";k.updateLink(event,this.options.pos),this.options.clickCallback&&this.options.clickCallback(event)};v.prototype._onPopoverTouchStart=function(event){"use strict";event.kill()};v.prototype._getJewelCount=function(){"use strict";if(this._count>0)return this._count;else return this._unreadCount};v.prototype._onOpen=function(){"use strict";__p&&__p();if(this._scrollAreaNode){m.scrollToHeader();var a=document.documentElement;g.conditionClass(a,"hide-scroll",!0);this._scrollAreaNode.style.maxHeight=a.offsetHeight-200+"px"}this._getJewelCount();i.pushSoftState(this._softState);this.handleViewedContent();o.invoke("m:jewel:flyout:open",null,{jewel:this._sigil});g.conditionClass(this._getJewelElement(),"popoverOpen",!0);a=h.find(this._getJewelElement(),"div","flyout");l.focusTabbable(a)};v.prototype._onClose=function(){"use strict";this._scrollAreaNode&&(this._scrollAreaNode.style.minHeight="",g.conditionClass(document.documentElement,"hide-scroll",!1)),o.invoke("m:jewel:flyout:close",null,{jewel:this._sigil}),g.conditionClass(this._getJewelElement(),"popoverOpen",!1),i.popSoftState(this._softState)};v.prototype.isOpen=function(){"use strict";return this._popover&&this._popover.isOpen()};v.prototype.openPopover=function(){"use strict";this._popover&&!this._popover.isOpen()&&this._popover.open()};v.prototype.reregisterListeners=function(){"use strict";var a=this.isOpen();this.clear();this._createPopover();a&&this._popover.open()};r(v,["cleared","jewel_click"]);Object.assign(v,{M_AREA_WHITE:"acw",M_AREA_LIGHTBLUE:"aclb",MARK_READ_DELAY:3e3,JEWEL_NAV_NODE_ID:"mJewelNav",nextID:0});Object.assign(v.prototype,{_sigil:null,_currentJewel:null,_count:0,_popover:null});e.exports=v}),null);
__d("FriendingSurfaceVisitationTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){h.log("logger:FriendingSurfaceVisitationLoggerConfig",this.$1,g.BASIC)};a.prototype.logVital=function(){h.log("logger:FriendingSurfaceVisitationLoggerConfig",this.$1,g.VITAL)};a.prototype.logImmediately=function(){h.log("logger:FriendingSurfaceVisitationLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setAppVersion=function(a){this.$1.app_version=a;return this};a.prototype.setBadgeCount=function(a){this.$1.badge_count=a;return this};a.prototype.setClientTimestamp=function(a){this.$1.client_timestamp=a;return this};a.prototype.setRawRefTab=function(a){this.$1.raw_ref_tab=a;return this};a.prototype.setRawTab=function(a){this.$1.raw_tab=a;return this};a.prototype.setRefPage=function(a){this.$1.ref_page=a;return this};a.prototype.setSurface=function(a){this.$1.surface=a;return this};a.prototype.setTargetProfileID=function(a){this.$1.target_profile_id=a;return this};a.prototype.setVC=function(a){this.$1.vc=a;return this};b={app_version:!0,badge_count:!0,client_timestamp:!0,raw_ref_tab:!0,raw_tab:!0,ref_page:!0,surface:!0,target_profile_id:!0,vc:!0};e.exports=a}),null);
__d("XFriendRequestIHEventLoggingController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/requests/interaction_history_logging/",{target_id:{type:"FBID",required:!0},log_event:{type:"String",required:!0}})}),null);
__d("MFriendRequestIHEventLogger",["DOM","FBJSON","MRequest","XFriendRequestIHEventLoggingController"],(function(a,b,c,d,e,f,g,h,i,j){__p&&__p();a={listenToProfileClick:function(a,b,c){a=h.parse(a.getAttribute("data-store"));var d=a.userid?a.userid.toString():null;g.listen(c,"click",null,function(){this.logClick(d)}.bind(this));g.listen(b,"click",null,function(){this.logClick(d)}.bind(this))},logImpression:function(a){a&&this._logEvent(a,"impression")},logClick:function(a){a&&this._logEvent(a,"click")},_logEvent:function(a,event){if(isNaN(a))return;a=j.getURIBuilder().setFBID("target_id",a).setString("log_event",event).getURI();new i(a).send()}};e.exports=a}),null);
__d("MJewels",[],(function(a,b,c,d,e,f){e.exports={REQUESTS:"requests",MESSAGES:"messages",NOTIFICATIONS:"notifications",SEARCH:"search",MORE:"more",NEWS_FEED:"news-feed",BOOKMARKS:"bookmarks",VIDEOS:"videos",CASUAL_GROUPS:"casual_groups",MARKETPLACE:"marketplace"}}),null);
__d("MMessagesThreadRowID",[],(function(a,b,c,d,e,f){"use strict";var g="other_user_fbid_",h="thread_fbid_";function a(a,b,c){return a+(b?g+b:h+String(c))}e.exports={getThreadRowID:a}}),null);
__d("MessagingEvent",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MARK_ALL_READ:"mark_all_read",MARK_ALL_SEEN:"mark_all_seen",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads",CHANGE_PAGE_THREAD_FLAG:"change_page_thread_flag",CREATE_PAGE_ADMIN_NOTE:"create_page_admin_note",NO_OP:"no_op"})}),null);
__d("XCasualGroupsJewelTabActivityController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/mobile/casual_groups/jewel/update_activity/",{})}),null);
__d("XExpireFriendRequestsMutationController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/ajax/requests/expire/",{from_m_jewel:{type:"Bool",defaultValue:!1}})}),null);
__d("XFBConfirmationCliffTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){h.log("logger:XFBConfirmationCliffLoggerConfig",this.$1,g.BASIC)};a.prototype.logVital=function(){h.log("logger:XFBConfirmationCliffLoggerConfig",this.$1,g.VITAL)};a.prototype.logImmediately=function(){h.log("logger:XFBConfirmationCliffLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setCliffCaller=function(a){this.$1.cliff_caller=a;return this};a.prototype.setError=function(a){this.$1.error=a;return this};a.prototype.setSurface=function(a){this.$1.surface=a;return this};a.prototype.updateExtraData=function(a){a=i(h.serializeMap(a));h.checkExtraDataFieldNames(a,j);this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.addToExtraData=function(a,b){var c={};c[a]=b;return this.updateExtraData(c)};var j={cliff_caller:!0,error:!0,surface:!0};e.exports=a}),null);
__d("XMessagesJewelContentController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/mobile/messages/jewel/content/",{spinner_id:{type:"String",required:!0}})}),null);
__d("XNotificationJewelContentController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/mobile/notifications/jewel/content/",{spinner_id:{type:"String",required:!0}})}),null);
__d("MJewelSet",["ChannelEventType","DOM","EventListener","FriendingSurfaceVisitationTypedLogger","MarauderLogger","MessagingEvent","MFriendRequestIHEventLogger","MHistory","MInitJewelCounts","MJewel","MJewels","MLegacyDataStore","MLogState","MMessagesThreadRowID","MPymkFunnelLogger","MRequest","MTouchChannelManager","MURI","MViewport","Popover","ScriptPath","Stratcom","XCasualGroupsJewelTabActivityController","XExpireFriendRequestsMutationController","XFBConfirmationCliffTypedLogger","XMessagesJewelContentController","XNotificationJewelContentController","cx","fbt","gkx","throttle"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K){__p&&__p();var L={_viewerID:null,_requestsJewel:null,_messagesJewel:null,_notificationsJewel:null,_unseenNotificationIds:{},_unseenThreadIDs:{},_unreadThreadIDs:{},_jewelClickLogListener:null,_messengerCliff:!1,_haveInitializedJewels:!1,_pymkAndRequestImpressionLogged:!1,MSG_ID_PREFIX:"msg_",NOTIF_ID_PREFIX:"notif_",JEWEL_NAV_NODE_ID:"mJewelNav",JEWEL_NAV_CACHE_KEY:"mJewelNavKey",JEWEL_MSG_LIST:"mJewelMsgThreadContents",_lazyLoadNotificationsReq:null,_lazyLoadMessagesReq:null,createJewels:function(a){a.showRequests&&(L._requestsJewel=new p("requests",{pos:s.CLICK_POSITION_REQUESTS_FLYOUT,softState:q.REQUESTS,jewelRedirect:a.shouldRedirectRequestsJewel},"friends_jewel_module"),L._requestsJewel.listen("cleared",L._markRequestsRead),L._requestsJewel.listen("jewel_click",L._logRequestsJewelClick)),a.showCasualGroups&&(L._casualGroupsJewel=new p("casual_groups",{softState:q.CASUAL_GROUPS},"casual_groups_jewel_module"),L._casualGroupsJewel.listen("jewel_click",L._updateCasualGroupsTabActivity)),a.showMessages&&(L._messagesJewel=new p("messages",{contentsSigil:L.JEWEL_MSG_LIST,pos:s.CLICK_POSITION_MESSAGES_FLYOUT,softState:q.MESSAGES},"messages_jewel_module"),L._messagesJewel.listen("cleared",L._markMessagesRead)),L._notificationsJewel=new p("notifications",{pos:s.CLICK_POSITION_NOTIFICATIONS_FLYOUT,softState:q.NOTIFICATIONS},"notifications_jewel_module"),L._notificationsJewel.listen("cleared",L._markNotificationsSeen),L._jewelClickLogListener=L._notificationsJewel.listen("jewel_click",L._logNotificationJewelClick),B.listen("m:jewel:flyout:open",null,L._onJewelOpen)},setMessengerCliff:function(a,b,c){L._messengerCliff=a},setMessengerCliffShouldLog:function(a,b){},markFriendRequestsSeen:function(event){if(L._requestsJewel===null)return;L._requestsJewel.setCount(0)},updateFriendRequests:function(event){if(L._requestsJewel===null)return;if(L._requestsJewel.isOpen())return;L._loadRequestsJewel()},updateFriendRequestsForce:function(event){if(L._requestsJewel===null)return;L._loadRequestsJewel()},onAfterUpdateFriendRequests:function(a){if(L._requestsJewel===null)return;L._setJewelCount(L._requestsJewel,a,L._markRequestsRead);z.getInstance("reqs_flyout").refreshConstraints();if(L._requestsJewel.isOpen()){a=L._requestsJewel._getContentsElement();L._logPymkAndRequestImpression(a)}},onAfterLoadMoreFriendSuggestions:function(){if(L._requestsJewel===null)return;z.getInstance("reqs_flyout").refreshConstraints()},_logPymkAndRequestImpression:function(a){__p&&__p();if(L._pymkAndRequestImpressionLogged)return;L._pymkAndRequestImpressionLogged=!0;a=h.scry(a,"div","undoable-action");for(var b=0;b<a.length;b++){var c=a[b].getAttribute("data-pymk-id");if(c){var d=a[b].getAttribute("data-signature");u.logImpression(c,d,"mobile_jewel")}else{c=r.get(a[b]).userid;k.log("request_seen","friend_request_waterfall",{request_id:c,request_location:"requests_jewel"});m.logImpression(c?c.toString():null)}}},refreshNotificationsConstraints:function(){z.getInstance("notifications_flyout").refreshConstraints()},refreshNotificationsConstraintsOnImageLoad:function(){var a=document.getElementById("notifications_flyout");if(!a)return;L.refreshNotificationsConstraints();var b=K(L.refreshNotificationsConstraints,500);h.scry(a,"img","notif_thumb").forEach(function(a){var c=i.listen(a,"load",function(){c.remove(),b()})})},refreshMessagesConstraints:function(){z.getInstance("messages_flyout").refreshConstraints()},updateNotification:function(event){__p&&__p();var a=event.getData();if(a&&a.data){if(a.data.type==="friend_confirmed")return;!L._notificationsJewel.isOpen()&&!L._unseenNotificationIds[a.data.alert_id]&&L._notificationsJewel.setCount(a.data.unread+L._notificationsJewel.getCount());L._notificationsJewel.removeMenuContent(L._getNotifNodeID(a.data.alert_id));L._unseenNotificationIds[a.data.alert_id]=!0;L._notificationsJewel.isOpen()&&L._markNotificationsSeen();L._loadNotificationJewelContent()}},updateUnseenNotificationIds:function(event){__p&&__p();var a=event.getData();if(!a)return;var b=event.getType()=="notifications_read";if(a.alert_ids){var c=0;for(var d=0;d<a.alert_ids.length;d++)L._unseenNotificationIds[a.alert_ids[d]]&&(delete L._unseenNotificationIds[a.alert_ids[d]],b&&L._notificationsJewel.updateMenuColor(L._getNotifNodeID(a.alert_ids[d]),!0,!1),c++);d=L._notificationsJewel.getCount();L._notificationsJewel.setCount(d-c)}else{L._notificationsJewel.setCount(0);if(b)for(var e in L._unseenNotificationIds)L._notificationsJewel.updateMenuColor(L._getNotifNodeID(e),!0,!1);L._unseenNotificationIds={}}},updateMessageCounts:function(event){__p&&__p();var a=event.getData();if(!a)return;if(a.event===l.READ&&a.message.folder==="inbox"){var b=a.message.thread_fbid||a.message.other_user_fbid;delete L._unseenThreadIDs[b];delete L._unreadThreadIDs[b]}else if(a.event===l.UNREAD&&a.message.folder==="inbox"){b=a.message.thread_fbid||a.message.other_user_fbid;L._unreadThreadIDs[b]=1}else if(a.event===l.MARK_ALL_READ&&a.message.folder==="inbox")L._unreadThreadIDs={},L._unseenThreadIDs={};else if(a.event===l.MARK_ALL_SEEN&&a.message.folder==="inbox")L._unseenThreadIDs={};else if(a.parsedPayload&&a.folder==="inbox"){b=a.parsedPayload;if(!L._viewerIsAParticipant(L._viewerID,b)||b.isUnread()===!1||a.message.is_muted)return;a=b.getThreadFBID()||b.getOtherUserFBID();L._unseenThreadIDs[a]=1;L._unreadThreadIDs[a]=1}else return;b=Object.keys(L._unseenThreadIDs).length;a=Object.keys(L._unreadThreadIDs).length;!L._messagesJewel.isOpen()&&b!==L._messagesJewel.getCount()&&L._messagesJewel.setCount(b);b=a>0?I._("Messages ({unread_message_count})",[I._param("unread_message_count",a)]):I._("Messages");L._messagesJewel.setHeaderText("messages_jewel_header_text",b)},updateMessage:function(event){__p&&__p();var a=event.getData();if(!a)return;if(a.parsedPayload){var b=a.parsedPayload;if(!b.getFolder||b.getFolder()!=="inbox"||!L._viewerIsAParticipant(L._viewerID,b))return;L._messagesJewel.isInitialized()&&(L._messagesJewel.removeMenuContent(L._getMessageNodeID(b.getOtherUserFBID(),b.getThreadFBID())),L._messagesJewel.isOpen()&&L._markMessagesRead());L._loadMessagesJewelContent()}else a.event===l.READ&&a.is_sync&&L._messagesJewel.updateMenuColor(L._getMessageNodeID(a.message.other_user_fbid,a.message.thread_fbid),!0,!1)},_getMessageNodeID:function(a,b){return t.getThreadRowID(L.MSG_ID_PREFIX,a,b)},_getNotifNodeID:function(a){return L.NOTIF_ID_PREFIX+a},_markRequestsRead:function(){B.invoke("m_requests_jewel_mark_read");var a=new v(new x("/a/jewel_requests_read.php").toString());a.send()},_markMessagesRead:function(){var a=new v(new x("/a/jewel_messages_read.php").toString());a.send()},_markNotificationsSeen:function(){L._jewelClickLogListener&&(L._jewelClickLogListener.remove(),L._jewelClickLogListener=null);var a=L._unseenNotificationIds;L._unseenNotificationIds={};var b=[];for(var c in a)b.push(c);a=new v(new x("/a/jewel_notifications_read.php").toString());a.addData({ids:b,count:b.length,seen:!0});a.send()},_onJewelOpen:function(event){__p&&__p();var a=event.getData();if(a&&a.jewel)if(a.jewel==="notifications")L._loadNotificationJewelContent();else if(a.jewel==="requests")new v(D.getURIBuilder().setBool("from_m_jewel",!0).getURI()).send();else if(a.jewel==="messages"){L._messengerCliff&&new E().setSurface("messenger_seen").log();var b=L._messagesJewel.getCount();L._messagesJewel.setCount(b);L._loadMessagesJewelContent()}A.set("topbar_"+a.jewel)},_loadNotificationJewelContent:function(){var a=L._notificationsJewel._getContentsElement(),b="notifications-flyout-loading";if(B.hasSigil(a,b)){b=G.getURIBuilder().setString("spinner_id",a.getAttribute("id")).getURI();L._lazyLoadNotificationsReq||(L._lazyLoadNotificationsReq=new v(b),L._lazyLoadNotificationsReq.listen("finally",function(){L._lazyLoadNotificationsReq=null}),L._lazyLoadNotificationsReq.send())}},_loadMessagesJewelContent:function(){var a=L._messagesJewel._getJewelElement(),b="messages-flyout-loading";a=h.scry(a,"*",b);if(a.length>0){b=F.getURIBuilder().setString("spinner_id",a[0].getAttribute("id")).getURI();L._lazyLoadMessagesReq||(L._lazyLoadMessagesReq=new v(b),L._lazyLoadMessagesReq.listen("finally",function(){L._lazyLoadMessagesReq=null}),L._lazyLoadMessagesReq.send())}},_logNotificationJewelClick:function(){L._jewelClickLogListener&&(L._jewelClickLogListener.remove(),L._jewelClickLogListener=null),new v("/a/jewel_notifications_log.php").addData({click_type:"jewel_click",count:L._notificationsJewel.getCount()}).send()},_updateCasualGroupsTabActivity:function(){var a=C.getURIBuilder().getURI();L._updateCasualGroupsTabActivityReq||(L._updateCasualGroupsTabActivityReq=new v(a),L._updateCasualGroupsTabActivityReq.listen("finally",function(){L._updateCasualGroupsTabActivityReq=null}),L._updateCasualGroupsTabActivityReq.send());L._casualGroupsJewel.setCount(0)},_logRequestsJewelClick:function(){var a=L._requestsJewel._getContentsElement();L._logRequestsImpessions(a);new j().setSurface("jewel").setBadgeCount(L._requestsJewel.getCount()).log();L.lazyLoadRequestsJewelIfTabOpen()},_logRequestsImpessions:function(a){__p&&__p();if(!a)return;a=h.scry(a,"div","attachment");var b=[];for(var c=0;c<a.length;c++){var d=a[c].getAttribute("id");d&&d.startsWith("m_jewel_req_")&&(b=b.concat(d.replace("m_jewel_req_","")))}if(b.length){d=new v("/friends/requests/log_impressions");d.setMethod("POST");d.addData({ids:b.join(","),ref:"m_jewel"});d.send()}},_viewerIsAParticipant:function(a,b){if(!b.getParticipantIDs())return!1;return b.getParticipantIDs().indexOf(a)>-1?!0:b.getParticipantIDs().indexOf(a.toString())>-1},_initJewelCount:function(a,b,c){a.setDuringInit(!0),a.reregisterListeners(),L._setJewelCount(a,b,c),a.setDuringInit(!1)},_setJewelCount:function(a,b,c){!a.isOpen()?a.setCount(b):b&&c()},_initJewelCounts:function(event){__p&&__p();var a=event.getData();L.initJewels(null,null);a.viewer_id&&(L._viewerID=a.viewer_id);a.unread_notification_ids&&(L._unseenNotificationIds=a.unread_notification_ids||{});a.unseen_thread_ids&&(L._unseenThreadIDs=a.unseen_thread_ids.reduce(function(a,b){a[b]=1;return a},{}));a.unread_thread_ids&&(L._unreadThreadIDs=a.unread_thread_ids.reduce(function(a,b){a[b]=1;return a},{}));a.request_count&&L._requestsJewel&&L._initJewelCount(L._requestsJewel,a.request_count,L._markRequestsRead);if(a.unseen_thread_ids&&L._messagesJewel){var b=a.unseen_thread_ids?a.unseen_thread_ids.length:0;b=b;L._initJewelCount(L._messagesJewel,b,L._markMessagesRead)}a.notification_count&&L._initJewelCount(L._notificationsJewel,a.notification_count,L._markNotificationsSeen)},lazyLoadRequestsJewelIfTabOpen:function(){__p&&__p();if(L._requestsJewel&&L._requestsJewel.isOpen()){var a=L._requestsJewel._getContentsElement();if(B.hasSigil(a,"requests-flyout-pagelet-placeholder"))return;if(B.hasSigil(a,"requests-flyout-loading"))L._loadRequestsJewel();else{a=L._requestsJewel._getContentsElement();L._logPymkAndRequestImpression(a)}}},_loadRequestsJewel:function(){new v("/ajax/mobile/friends/jewel/requests_markup").send()},_initUIStateListener:function(){__p&&__p();var a,b=function(b){__p&&__p();b=document.getElementsByClassName("_3wo2")[0];if(b){var c=n.getState();a&&(b.classList.remove(a),a=null);if(c)a="-softstate-"+c,b.classList.add(a);else{var d=window.location.pathname;if(d){d.indexOf("/")===0&&(d=d.substring(1));var e=d.indexOf("/");e!==-1&&(d=d.substring(0,e));c=d}a="-hardstate-"+c;b.classList.add(a)}}};["m:history:change","m:history:change-default"].forEach(function(a){B.listen(a,null,function(){b(a)})});b()},initJewels:function(a,b){__p&&__p();if(L._haveInitializedJewels&&(!b||!J("AT5J2eFdLcTezMMRuE1M2NArKONL3RlguQ3m5VpzRWaCJmORt3i3mxTzCtS25Y1Rb4viPrwXLvzxr8xWpv6prWj_")))return;L._haveInitializedJewels=!0;w.initialize();L.createJewels(b||{});this._initUIStateListener();L._requestsJewel&&(L._friendRequestAddListener||(L._friendRequestAddListener=B.listen("jewel_requests_add",null,L.updateFriendRequests)),L._friendRequestRemoveListener||(L._friendRequestRemoveListener=B.listen("jewel_requests_remove_old",null,L.updateFriendRequests)),L._friendRequestExpiredListener||(L._friendRequestExpiredListener=B.listen("friend_requests_expired",null,L.updateFriendRequestsForce)),L._friendAcceptedListener||(L._friendAcceptedListener=B.listen("jewel_friending_notifs",null,L.updateFriendRequests)),L._friendRequestUpdatedCountListener||(L._friendRequestUpdatedCountListener=B.listen("mobile_requests_count",null,L.updateFriendRequests)),L._friendRequestSeenListener||(L._friendRequestSeenListener=B.listen("friend_requests_seen",null,L.markFriendRequestsSeen)));L._notificationListener||(L._notificationListener=B.listen("m_notification",null,L.updateNotification));L._notificationRefreshListener||(L._notificationRefreshListener=B.listen("m:jewel-set:notifications-jewel:refresh-flyout",null,L.refreshNotificationsConstraints));L._messagesJewel&&(L._messageListener||(L._messageListener=B.listen(g.MESSAGE,null,L.updateMessage)),L._messageCountListener||(L._messageCountListener=B.listen(g.MESSAGE,null,L.updateMessageCounts)));L._notifReadListener||(L._notifReadListener=B.listen("notifications_read",null,L.updateUnseenNotificationIds));L._notifSeenListener||(L._notifSeenListener=B.listen("notifications_seen",null,L.updateUnseenNotificationIds));L._friendRequestResponseListener||(L._friendRequestResponseListener=B.listen("m:requests:refresh",null,function(){z.getInstance("reqs_flyout").refreshConstraints()}));L._orientationChangeListener||(L._orientationChangeListener=B.listen("m:viewport:orientation-change",null,L._onOrientationChange));B.listen("m:jewels:init-counts",null,L._initJewelCounts);o.replayMissedEvents()},_onOrientationChange:function(){setTimeout(function(){var a=z._activePopover;if(!a)return;y.getHeight()+"px"!==a.flyout.style.minHeight&&a.refreshConstraints()},800)}};e.exports=L}),null);
__d("MJewelThreads",["Bootloader","ChannelEventType","MessagingEvent","Stratcom"],(function(a,b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();function a(a){this.$1=a,this.$2=[],this.$3=!1,this.$4=!1,j.listen(h.MESSAGE,null,this.onMessageEvent.bind(this))}a.prototype.getThreads=function(){return this.$2};a.prototype.registerListeners=function(){j.listen("click","live-threads",this.onThreadClick.bind(this)),j.listen("m:jewel:flyout:open",null,this.onJewelOpen.bind(this))};a.prototype.onJewelOpen=function(event){var a=event.getData();a=a&&a.jewel&&a.jewel==="messages";a&&this.$4&&this.updateUI()};a.prototype.onThreadClick=function(event){var a=event.getNode("live-thread");if(!a)return;this.setThreadReadStatus(a.getAttribute("data-fbid"),a.getAttribute("data-canonical")==="true",!0);this.updateUI()};a.prototype.onMessageEvent=function(event){__p&&__p();var a=event.getData();if(a.parsedPayload){var b=a.parsedPayload;if(b.getFolder()!=="inbox")return;this.$3||(this.$3=!0,this.registerListeners());this.addThread(b)}else if(Object.prototype.hasOwnProperty.call(a,"mark_as_read"))a.other_user_fbids.forEach(function(b){this.setThreadReadStatus(b.toString(),!0,a.mark_as_read)}.bind(this)),a.thread_fbids.forEach(function(b){this.setThreadReadStatus(b.toString(),!1,a.mark_as_read)}.bind(this)),this.updateUI();else if(a.event===i.READ&&a.is_sync){b=!!a.message.other_user_fbid;var c=b?a.message.other_user_fbid:a.message.thread_fbid;this.setThreadReadStatus(c,b,!0);this.updateUI()}};a.prototype.addThread=function(a){this.$2=this.$2.filter(function(b){b=b.isCanonicalThread()?b.getOtherUserFBID():b.getThreadFBID();return!this.isSameThread(b,a.isCanonicalThread(),a)}.bind(this)),a.unread=a.isUnread(),this.$2.push(a),this.$4=!0,this.updateThreadImage(a)};a.prototype.updateThreadImage=function(a){g.loadModules(["MMessagesThreadMetadataCache","MShortProfiles"],function(b,c){if(a.hasThreadImage())b.get(a.getThreadFBID(),function(b){a.image_src=b.image_src,this.updateUI()}.bind(this));else{b=a.isCanonicalThread()?a.getOtherUserFBID():a.getAuthorFBID();c.get(b,function(b){a.image_src=b.mThumbSrcSmall,this.updateUI()}.bind(this))}}.bind(this),"MJewelThreads")};a.prototype.setThreadReadStatus=function(a,b,c){this.$2.forEach(function(d){this.isSameThread(a,b,d)&&(d.unread==c&&(this.$4=!0),d.unread=!c)}.bind(this))};a.prototype.isSameThread=function(a,b,c){b=b?c.getOtherUserFBID():c.getThreadFBID();return a==b};a.prototype.updateUI=function(){if(!this.$3||!this.$4)return;g.loadModules(["React","ReactDOM","MJewelThreadList.react","Popover"],function(a,b,c,d){if(!d.getInstance("messages_flyout").isOpen())return;var e={threads:this.$2};b.render(a.createElement(c,e),this.$1);d.getInstance("messages_flyout").refreshConstraints();this.$4=!1}.bind(this),"MJewelThreads")};e.exports=a}),null);
__d("MSideNavMarauderLogger",["MarauderLogger","MLegacyDataStore","MTouchClick","Stratcom"],(function(a,b,c,d,e,f,g,h,i,j){__p&&__p();var k="";function a(event){g.toggleModule("sidebar_menu",!0)}function b(event){g.toggleModule("sidebar_menu",!1)}function c(event){var a=event.getNode("tag:a"),b=event.getNode("tag:div");g.log("open_application","sidebar_menu",{application_link_type:"local_module",display_name:b?b.innerText:"unknown",url:a&&a.href});g.setNavigationModule("sidebar_menu")}function d(){o("session_start")}function f(){o("cancel")}function l(a){__p&&__p();a=a.getData();if(a.node.rel<=0)return;var b=0,c="",d=h.get(a.node);d&&(b=d.bootstrap?1:0,c=d.type);d=0;var e=null;for(var f=0;f<a.results.length;f++){var g=a.results[f];if(g.rel>0){if(g.rel==a.node.rel){e=d;break}d++}}o("click",{query:a.query,is_bootstrapped:b,display_position:e},c,a.node.rel)}function m(a){a=a.getData();o("click",{query:a.query,is_bootstrapped:a.node.bootstrap?1:0,display_position:a.position},a.node.type,a.node.id)}function n(a){k!==a&&o("search_keystroke",{prev_query:k,new_query:a}),k=a}function o(a,b,c,d){g.log(a,"search_typeahead",b,c,d)}function p(a){return a.listen("change",n)}j.listen("m:side-area:show",null,a);j.listen("m:side-area:hide",null,b);j.listen("click","side-menu-item",c);a=i.hasTouchEvents()?"touchend":"click";j.listen(a,"search-activator",d);j.listen(a,"graph-search-activator",d);j.listen("click","graph-search-entry-point",d);j.listen("m:search-overlay:cancel",null,f);j.listen("m:search-overlay:cancel-react",null,f);j.listen("m:search-typeahead:select",null,l);j.listen("m:search-typeahead:select-react",null,m);e.exports={setupTypeaheadListener:p}}),null);
__d("MNotificationClick",["CSS","MLegacyDataStore","MRequest","Stratcom"],(function(a,b,c,d,e,f,g,h,i,j){__p&&__p();var k="notification",l="list_",m="acw",n="aclb",o={},p=!1;e.exports={init:function(){if(p)return;j.listen("click",k,q);j.listen("m:page:render:cache:complete",null,r);p=!0}};function q(event){var a=event.getNode("touchable");if(!a)return;var b=h.get(a).notif_id;if(!b)return;new i("/a/jewel_notifications_log.php").addData({click_type:"notification_click",id:b,target_id:h.get(a).target_id}).send();s(event)}function r(a){if(a.getData().path.indexOf("notifications")>-1)for(var b in o)t(b)}function s(event){__p&&__p();var a=event.getNode("marea");if(!a)return;a=a.getAttribute("id");if(!a)return;t(a);var b=a.startsWith(l)?a.substring(l.length):l+a;t(b);o[a]=!0;o[b]=!0}function t(a){a=document.getElementById(a);a&&(g.addClass(a,m),g.removeClass(a,n))}}),null);
__d("MPopoverClose",["Popover"],(function(a,b,c,d,e,f,g){a=function(){g._activePopover&&g._activePopover.close()};f.main=a}),null);
__d("formatNumber",["fbt","intlNumUtils"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();function a(a,b){return h.formatNumber(a,b)}function i(a,b){b=g._({"*":"{number}+"},[g._param("number",h.formatNumberWithThousandDelimiters(a,b),[0,a])]);return b.toString()}function j(a,b){b=g._({"*":"\u003C{number}"},[g._param("number",h.formatNumberWithThousandDelimiters(a,b),[0,a])]);return b.toString()}function b(a,b,c){return a>b?i(b,c):h.formatNumberWithThousandDelimiters(a,c)}function c(a,b,c){return a<b?j(b,c):h.formatNumberWithThousandDelimiters(a,c)}a.withThousandDelimiters=h.formatNumberWithThousandDelimiters;a.withMaxLimit=b;a.withMinLimit=c;e.exports=a}),null);